<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Lessons</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
        }
        .quiz-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .option-button {
            width: 100%;
            text-align: left;
            margin-bottom: 10px;
        }
        .correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .key-text {
            font-style: italic;
            color: #6c757d;
            margin-top: 10px;
            border-left: 3px solid #007bff;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container mt-5 text-center">
        <h1 class="mb-4">Quiz Lessons</h1>
        <button id="go-to-bottom" class="btn btn-primary mt-3" onclick="goToBottom()">Go to Bottom</button>
        <div class="row" id="lessons-container">
            </div>
        <div id="quiz-container" class="mt-5"></div>
        <button id="back-button" class="btn btn-secondary mt-3" style="display: none;">Back to Lessons</button>
    </div>

    <div id="bottom-of-page"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchLessons();
        });

        function fetchLessons() {
            fetch('lessons_list.json')
                .then(response => response.json())
                .then(lessons => {
                    const lessonsContainer = document.getElementById('lessons-container');
                    lessonsContainer.innerHTML = ''; // Clear previous buttons
                    lessons.forEach(lesson => {
                        const buttonCol = document.createElement('div');
                        buttonCol.className = 'col-12 mb-3';
                        const lessonButton = document.createElement('button');
                        lessonButton.className = 'btn btn-info btn-lg btn-block';
                        lessonButton.textContent = lesson.title;
                        lessonButton.onclick = () => loadQuiz(lesson.filename);
                        buttonCol.appendChild(lessonButton);
                        lessonsContainer.appendChild(buttonCol);
                    });
                })
                .catch(error => console.error('Error fetching lessons:', error));
        }

        function loadQuiz(filename) {
            document.getElementById('lessons-container').style.display = 'none';
            document.getElementById('back-button').style.display = 'block';
            document.getElementById('go-to-bottom').style.display = 'none';
            
            fetch(filename)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to load ${filename}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const quizContainer = document.getElementById('quiz-container');
                    quizContainer.innerHTML = '';
                    const quizTitle = document.createElement('h2');
                    quizTitle.textContent = data.quizTitle;
                    quizContainer.appendChild(quizTitle);

                    data.questions.forEach(q => {
                        const questionCard = document.createElement('div');
                        questionCard.className = 'quiz-card';

                        const questionText = document.createElement('h5');
                        questionText.textContent = `${q.id}. ${q.question}`;
                        questionCard.appendChild(questionText);

                        q.options.forEach(optionText => {
                            const button = document.createElement('button');
                            button.className = 'btn btn-outline-primary option-button';
                            button.textContent = optionText;
                            button.onclick = () => checkAnswer(button, optionText, q.answer, questionCard, q.key);
                            questionCard.appendChild(button);
                        });

                        quizContainer.appendChild(questionCard);
                    });

                    // Add a "Go to Top" button at the bottom of the quiz
                    const goToTopButton = document.createElement('button');
                    goToTopButton.id = 'go-to-top';
                    goToTopButton.className = 'btn btn-primary mt-3';
                    goToTopButton.textContent = 'Go to Top';
                    goToTopButton.onclick = () => goToTop();
                    quizContainer.appendChild(goToTopButton);

                })
                .catch(error => {
                    console.error('Error loading quiz:', error);
                    document.getElementById('quiz-container').innerHTML = `<p class="text-danger">Failed to load quiz. Please check the filename in lessons_list.json.</p>`;
                });
        }

        function checkAnswer(button, selectedOption, correctAnswer, questionCard, keyText) {
            const allButtons = questionCard.querySelectorAll('.option-button');
            allButtons.forEach(btn => btn.disabled = true); // Disable all buttons after one is clicked

            const keyContainer = document.createElement('p');
            keyContainer.className = 'key-text';
            keyContainer.textContent = keyText;
            questionCard.appendChild(keyContainer);

            if (selectedOption.trim() === correctAnswer.trim()) {
                button.classList.add('correct');
                button.classList.remove('btn-outline-primary');
            } else {
                button.classList.add('incorrect');
                button.classList.remove('btn-outline-primary');
                // Highlight the correct answer
                allButtons.forEach(btn => {
                    if (btn.textContent.trim() === correctAnswer.trim()) {
                        btn.classList.add('correct');
                        btn.classList.remove('btn-outline-primary');
                    }
                });
            }
        }
        
        document.getElementById('back-button').addEventListener('click', () => {
            document.getElementById('lessons-container').style.display = 'flex';
            document.getElementById('quiz-container').innerHTML = '';
            document.getElementById('back-button').style.display = 'none';
            document.getElementById('go-to-bottom').style.display = 'block';
        });

        function goToBottom() {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth'
            });
        }

        function goToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
    </script>
</body>
</html>
